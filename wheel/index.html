<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fortune Wheel</title>

  <!-- Inter Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            casinoDark: "#0C0A16",
            casinoCard: "#151226",
            casinoPurple: "#A56BFF",
            casinoGlow: "#CFAAFF",
            successGreen: "#28a745",
            errorRed: "#dc3545",
            infoBlue: "#0d6efd"
          },
          fontFamily: {
            sans: ["Inter", "system-ui"]
          }
        }
      }
    };
  </script>

  <!-- Vue -->
  <script src="https://unpkg.com/vue@3.4.21/dist/vue.global.prod.js"></script>

  <!-- Lucide -->
  <script defer src="https://unpkg.com/lucide@0.258.0/dist/umd/lucide.js"></script>

  <style>
    .wheel-container {
      position: relative;
      width: 300px;
      height: 300px;
      margin: 0 auto;
      border-radius: 50%;
      border: 8px solid #A56BFF;
      overflow: hidden;
      transform: rotate(0deg);
      transition: transform 5s cubic-bezier(0.33, 1, 0.68, 1);
    }

    .wheel-segment {
      position: absolute;
      width: 50%;
      height: 50%;
      top: 50%;
      left: 50%;
      transform-origin: 0% 0%;
      background: conic-gradient(#FF5A5A 0deg 10deg, #FFA500 10deg 20deg, #28a745 20deg 30deg, #0d6efd 30deg 40deg, #CFAAFF 40deg 50deg, #A56BFF 50deg 60deg, #FF5A5A 60deg 70deg, #FFA500 70deg 80deg, #28a745 80deg 90deg, #0d6efd 90deg 100deg, #CFAAFF 100deg 110deg, #A56BFF 110deg 120deg, #FF5A5A 120deg 130deg, #FFA500 130deg 140deg, #28a745 140deg 150deg, #0d6efd 150deg 160deg, #CFAAFF 160deg 170deg, #A56BFF 170deg 180deg, #FF5A5A 180deg 190deg, #FFA500 190deg 200deg, #28a745 200deg 210deg, #0d6efd 210deg 220deg, #CFAAFF 220deg 230deg, #A56BFF 230deg 240deg, #FF5A5A 240deg 250deg, #FFA500 250deg 260deg, #28a745 260deg 270deg, #0d6efd 270deg 280deg, #CFAAFF 280deg 290deg, #A56BFF 290deg 300deg, #FF5A5A 300deg 310deg, #FFA500 310deg 320deg, #28a745 320deg 330deg, #0d6efd 330deg 340deg, #CFAAFF 340deg 350deg, #A56BFF 350deg 360deg));
    }

    .wheel-pointer {
      position: absolute;
      top: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 12px solid transparent;
      border-right: 12px solid transparent;
      border-bottom: 20px solid #A56BFF;
      z-index: 10;
    }
  </style>
</head>

<body class="bg-casinoDark text-white font-sans antialiased">
  <div id="app" class="min-h-screen p-6 pb-24">

    <!-- Header -->
    <div class="flex items-center justify-between mb-6">
      <div>
        <div class="text-lg font-semibold">Fortune Wheel</div>
        <div class="text-sm text-gray-400">Spin the wheel and try your luck!</div>
      </div>
      <span class="p-2 rounded-full bg-casinoCard shadow">
        <i data-lucide="dollar-sign" class="text-gray-300"></i>
      </span>
    </div>

    <!-- Bet Input -->
    <div class="bg-casinoCard p-5 rounded-2xl shadow-lg mb-6">
      <label class="text-gray-300 text-sm">Enter Bet Amount (â‚¦)</label>
      <input type="number" v-model="betAmount"
        class="mt-2 w-full p-3 rounded-xl bg-casinoDark border border-gray-700 focus:border-casinoPurple outline-none"
        placeholder="e.g. 1000" />

      <label class="text-gray-300 text-sm mt-4">Pick a Number (0â€“36)</label>
      <input type="number" v-model="selectedNumber"
        class="mt-2 w-full p-3 rounded-xl bg-casinoDark border border-gray-700 focus:border-casinoPurple outline-none"
        placeholder="e.g. 17" min="0" max="36" />

      <label class="text-gray-300 text-sm mt-4">Select Odds</label>
      <div class="flex gap-3 mt-2">
        <button v-for="o in odds" :key="o" @click="selectedOdd=o"
          :class="['flex-1 py-2 rounded-xl font-semibold', selectedOdd===o ? 'bg-casinoPurple text-white' : 'bg-gray-700 text-gray-300']">
          X{{ o }}
        </button>
      </div>

      <button @click="spinWheel"
        class="w-full mt-5 py-3 rounded-full bg-casinoPurple text-white font-semibold flex items-center justify-center gap-2">
        <i data-lucide="play"></i> Spin Wheel
      </button>
    </div>

    <!-- Wheel Display -->
    <div class="relative bg-casinoCard p-5 rounded-2xl shadow-lg mb-6 flex justify-center items-center">
      <div class="wheel-pointer"></div>
      <div class="wheel-container" ref="wheel"></div>
    </div>

    <!-- Notification -->
    <transition name="fade">
      <div v-if="notification.message"
        :class="['mt-4 p-4 rounded-lg text-white font-medium', notification.type === 'success' ? 'bg-successGreen' : notification.type === 'error' ? 'bg-errorRed' : 'bg-infoBlue']">
        {{ notification.message }}
      </div>
    </transition>

  </div>

  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          token: "",
          betAmount: "",
          selectedNumber: "",
          odds: [2, 3, 4, 5],
          selectedOdd: 2,
          rouletteResult: null,
          notification: { message: "", type: "info" },
          spinning: false
        };
      },
      mounted() {
        setTimeout(() => lucide.createIcons(), 100);
        this.token = localStorage.getItem("casino_token");
        if (!this.token) {
          alert("Login required");
          window.location.href = "/login";
        }
      },
      methods: {
        async spinWheel() {
          if (this.spinning) return;
          if (!this.betAmount || this.betAmount < 100) return this.showNotification("Enter a valid bet amount (min â‚¦100)", "error");
          if (this.selectedNumber === "" || this.selectedNumber < 0 || this.selectedNumber > 36) return this.showNotification("Pick a number between 0 and 36", "error");
          if (!this.selectedOdd) return this.showNotification("Select odds!", "error");

          this.spinning = true;
          this.showNotification("Debiting walletâ€¦", "info");

          // Debit wallet first
          const debitPayload = {
            token: this.token,
            amount: Number(this.betAmount),
            reference: "DEBIT" + Date.now(),
            description: "Fortune Wheel Bet"
          };

          try {
            const debitRes = await fetch("https://favour-amaaavl.xyz/api/fund/sub", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(debitPayload)
            });
            const debitData = await debitRes.json();
            if (!debitData.status) {
              this.spinning = false;
              return this.showNotification("Debit failed: " + (debitData.message || "Unknown error"), "error");
            }

            // Determine spin result
            const wheelNumbers = Array.from({ length: 37 }, (_, i) => i);
            const resultNumber = wheelNumbers[Math.floor(Math.random() * 37)];
            const spins = 5; // number of spins before stop
            const degreePerNumber = 360 / 37;
            const finalDegree = 360 * spins + (resultNumber * degreePerNumber);

            // Animate wheel
            this.$refs.wheel.style.transition = "transform 5s cubic-bezier(0.33, 1, 0.68, 1)";
            this.$refs.wheel.style.transform = `rotate(${finalDegree}deg)`;

            setTimeout(async () => {
              this.rouletteResult = resultNumber;

              // Determine win/loss
              const win = Math.random() < 0.3 && Number(this.selectedNumber) === this.rouletteResult;
              if (win) {
                const winAmount = Number(this.betAmount) * this.selectedOdd;

                // Credit wallet
                const creditPayload = {
                  token: this.token,
                  amount: winAmount,
                  reference: "CREDIT" + Date.now(),
                  description: `Fortune Wheel Win X${this.selectedOdd}`
                };

                const creditRes = await fetch("https://favour-amaaavl.xyz/api/fund/add", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify(creditPayload)
                });

                const creditData = await creditRes.json();
                if (creditData.status) {
                  this.showNotification(`ðŸŽ‰ You won â‚¦${winAmount}!`, "success");
                } else {
                  this.showNotification("Credit failed: " + (creditData.message || ""), "error");
                }
              } else {
                this.showNotification(`ðŸ˜ž You lost! The wheel landed on ${this.rouletteResult}`, "error");
              }
              this.spinning = false;
            }, 5200);

          } catch (err) {
            this.spinning = false;
            this.showNotification("Request failed: " + err.message, "error");
          }
        },
        showNotification(message, type) {
          this.notification.message = message;
          this.notification.type = type;
          setTimeout(() => { this.notification.message = ""; }, 4000);
        }
      }
    }).mount("#app");
  </script>

  <style>
    .fade-enter-active,
    .fade-leave-active {
      transition: opacity 0.5s;
    }
    .fade-enter-from,
    .fade-leave-to {
      opacity: 0;
    }
  </style>
</body>

          </html>
