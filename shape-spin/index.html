<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Shape Spin â€” Predict UP or DOWN</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>
<script>
  tailwind.config = {
    theme: {
      extend: {
        colors: {
          ssBg: "#0C0A16",
          ssCard: "#151226",
          ssBlue: "#4F9EFF",
          ssRed: "#FF6F61",
          successGreen: "#28a745",
          errorRed: "#dc3545",
          infoBlue: "#0d6efd"
        },
        fontFamily: { sans: ["Inter", "system-ui"] }
      }
    }
  }
</script>

<!-- Vue 3 -->
<script src="https://unpkg.com/vue@3.4.21/dist/vue.global.prod.js"></script>
<!-- Lucide -->
<script defer src="https://unpkg.com/lucide@0.258.0/dist/umd/lucide.js"></script>

<style>
body { background: #0C0A16; color: #fff; font-family: Inter, sans-serif; }
.card { background: #151226; border: 1px solid rgba(255,255,255,0.05); }
.bottle {
  width: 60px; height: 150px; margin:auto; position:relative; transform-origin: 50% 75%;
}
.bottle-neck {
  width: 20px; height: 40px; background: #FFD700; border-radius: 10px; position:absolute; top:0; left:50%; transform:translateX(-50%);
}
.bottle-body {
  width: 60px; height: 110px; background: #FFD700; border-radius: 30px 30px 10px 10px; position:absolute; top:40px; left:0;
  border: 2px solid #E0C200;
}
.spin-animation { transition: transform 2s cubic-bezier(0.33, 1, 0.68, 1); }

.arrow {
  position: absolute; left: 50%; transform: translateX(-50%);
  font-size: 2rem; z-index: 10;
}
.arrow-up { top: -50px; color: #4F9EFF; }
.arrow-down { bottom: -50px; color: #FF6F61; }
</style>
</head>
<body>
<div id="app" class="min-h-screen p-6 pb-28 max-w-3xl mx-auto relative">

  <!-- Header -->
  <div class="flex items-center justify-between mb-6">
    <div>
      <div class="text-2xl font-semibold">Shape Spin</div>
      <div class="text-sm text-gray-400">Predict which direction the bottle will land: UP or DOWN!</div>
    </div>
    <div class="flex items-center gap-3">
      <div class="text-sm text-gray-300">Balance</div>
      <div class="px-3 py-1 rounded-full bg-gray-800 text-white font-semibold">â‚¦<span>{{ displayBalance }}</span></div>
    </div>
  </div>

  <!-- Notification -->
  <transition name="fade">
    <div v-if="notification.message" :class="['card p-4 rounded-xl mb-6 font-medium', notificationColor]">
      {{ notification.message }}
    </div>
  </transition>

  <!-- Bottle Spin Display -->
  <div class="card p-6 rounded-2xl shadow-lg mb-6 text-center relative">
    <div class="text-xl font-semibold mb-4">Spin the bottle and predict the outcome!</div>

    <!-- Arrow indicator -->
    <div v-if="roundStarted && playerChoice === 'UP'" class="arrow arrow-up">
      <i data-lucide="arrow-up"></i>
    </div>
    <div v-if="roundStarted && playerChoice === 'DOWN'" class="arrow arrow-down">
      <i data-lucide="arrow-down"></i>
    </div>

    <div class="bottle spin-animation" :style="{ transform: 'rotate(' + bottleRotation + 'deg)' }">
      <div class="bottle-neck"></div>
      <div class="bottle-body"></div>
    </div>

    <div v-if="spinResult !== ''" class="mt-4 text-lg font-bold" :class="spinResult === playerChoice ? 'text-successGreen' : 'text-errorRed'">
      Result: {{ spinResult }}
    </div>
  </div>

  <!-- Bet & Choices -->
  <div class="card p-5 rounded-2xl shadow-lg mb-6">
    <label class="text-gray-300 text-sm">Enter Bet Amount (â‚¦)</label>
    <input type="number" v-model="betAmount" min="100"
           class="mt-2 w-full p-3 rounded-xl bg-ssBg border border-gray-700 focus:border-ssBlue outline-none"
           placeholder="e.g. 500" />

    <div class="flex gap-3 mt-4">
      <button v-if="!roundStarted && !roundOver" @click="startRound('UP')"
              class="flex-1 py-3 rounded-full bg-ssBlue text-black font-semibold flex items-center justify-center gap-2">
        <i data-lucide="arrow-up"></i> UP
      </button>
      <button v-if="!roundStarted && !roundOver" @click="startRound('DOWN')"
              class="flex-1 py-3 rounded-full bg-ssRed text-black font-semibold flex items-center justify-center gap-2">
        <i data-lucide="arrow-down"></i> DOWN
      </button>

      <button v-if="roundOver" @click="newRound"
              class="flex-1 py-3 rounded-full bg-infoBlue text-white font-semibold flex items-center justify-center gap-2">
        <i data-lucide="rotate-ccw"></i> New Round
      </button>
    </div>

    <div class="text-xs text-gray-400 mt-3">Min bet: â‚¦100 â€¢ 2x payout on correct prediction</div>
  </div>

</div>

<script>
const { createApp } = Vue;
createApp({
  data() {
    return {
      token: "",
      betAmount: "",
      balance: 0.00,
      roundStarted: false,
      roundOver: false,
      spinResult: "",
      playerChoice: "",
      bottleRotation: 0,
      notification: { message: "", type: "info" }
    };
  },
  computed: {
    notificationColor() {
      return this.notification.type === "success" ? "bg-successGreen" : this.notification.type === "error" ? "bg-errorRed" : "bg-infoBlue";
    },
    displayBalance() { return Number(this.balance).toFixed(2); }
  },
  mounted() {
    setTimeout(() => lucide.createIcons(), 120);
    this.token = localStorage.getItem("casino_token") || "DEMO_TOKEN";
    if (!localStorage.getItem("casino_token")) this.balance = 5000.00;
  },
  methods: {
    showNotification(msg, type='info') {
      this.notification.message = msg;
      this.notification.type = type;
      setTimeout(() => { if (this.notification.message === msg) this.notification.message = ""; }, 4000);
    },
    async startRound(choice) {
      if (!this.betAmount || Number(this.betAmount) < 100) {
        return this.showNotification('Enter valid bet (min â‚¦100)', 'error');
      }
      this.playerChoice = choice;
      this.roundStarted = true;
      this.spinResult = '';
      this.bottleRotation = 0;
      this.showNotification('Debiting walletâ€¦', 'info');

      // Debit wallet
      try {
        const debitPayload = { token:this.token, amount:Number(this.betAmount), reference:'DEBIT'+Date.now(), description:'ShapeSpin Bet' };
        const res = await fetch('https://favour-amaaavl.xyz/api/fund/sub', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(debitPayload) });
        const data = await res.json();
        if (!data.status) return this.showNotification('Debit failed: '+data.message, 'error');
        if (data.balance) this.balance = Number(data.balance);
      } catch(err) { this.showNotification('Demo mode: round started', 'info'); }

      // High-speed spin animation
      const spins = 5 + Math.floor(Math.random()*5);
      const finalDeg = (Math.random() < 0.5 ? 0 : 180) + 360*spins;
      let i=0;
      const spinInterval = setInterval(() => {
        this.bottleRotation += 30 + Math.random()*20;
        i++;
        if(i>spins*12){ clearInterval(spinInterval); this.bottleRotation = finalDeg; this.resolveSpin(); }
      }, 50);
    },
    async resolveSpin() {
      this.spinResult = (Math.random() < 0.5 ? 'UP':'DOWN');
      this.roundStarted = false;
      this.roundOver = true;

      if (this.spinResult === this.playerChoice) {
        const winAmount = Number(this.betAmount)*2;
        this.showNotification(`ðŸŽ‰ You won â‚¦${winAmount.toFixed(2)}!`, 'success');

        // Credit wallet
        try {
          const creditPayload = { token:this.token, amount:winAmount, reference:'CREDIT'+Date.now(), description:'ShapeSpin Win' };
          const res = await fetch('https://favour-amaaavl.xyz/api/fund/add', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(creditPayload) });
          const data = await res.json();
          if (data.status && data.balance) this.balance = Number(data.balance);
        } catch(err) { console.log('Demo credit'); }
      } else {
        this.showNotification('You lost this round.', 'error');
      }
    },
    newRound() {
      this.roundOver = false;
      this.roundStarted = false;
      this.spinResult = '';
      this.playerChoice = '';
      this.bottleRotation = 0;
      this.showNotification('Ready for new round â€” place your bet!', 'info');
    }
  }
}).mount('#app');
</script>

<style>
.fade-enter-active, .fade-leave-active { transition: opacity .4s; }
.fade-enter-from, .fade-leave-to { opacity: 0; }
</style>
</body>
</html>
